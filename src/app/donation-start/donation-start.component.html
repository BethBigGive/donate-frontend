<div class="b-container" *ngIf="campaign">
  <div class="b-back-button">
    <button mat-icon-button class="c-campaign-button" [routerLink]="'/campaign/' + campaign.id">
      <mat-icon class="campaign-icon" aria-hidden="false" aria-label="Back">keyboard_arrow_left</mat-icon>
      Back to campaign
    </button>
  </div>

  <div fxLayout="row" fxLayout.xs="column">
    <div class="b-primary-column">
      <div class="page-header">
        <h3 class="b-rh-2 b-light">You are donating to:</h3>
        <h1 class="b-rh-1 b-bold">{{ campaign.charity.name }}!</h1>
        <h3 class="b-rh-2 b-light">For:</h3>
        <h2 class="b-rh-1 b-bold">{{ campaign.title }}</h2>
      </div>

      <form (ngSubmit)="submit()" [formGroup]="donationForm" *ngIf="campaign">
        <div *ngIf="campaignIsOpen()">
          <mat-accordion multi="true">
            <mat-expansion-panel class="c-your-donation" expanded="true" disabled="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3 class="b-rh-2">Your donation</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-form-field class="b-center" color="accent">
                <mat-label for="donationAmount">Enter an amount (£)</mat-label>
                <input formControlName="donationAmount" id="donationAmount" matInput>
              </mat-form-field>
              <p class="b-center b-grey b-rt-0">Or, choose</p>
              <div class="c-suggested-amount" fxLayout="row">
                <button
                  fxFlex="calc((100 - 1rem)/3)"
                  class="c-suggested-amount__button"
                  type="button"
                  *ngFor="let suggestedAmount of suggestedAmounts"
                  (click)="setAmount(suggestedAmount)"
                >{{ suggestedAmount | currency : '£' : 'symbol' : '1.0-0' }}</button>
              </div>

              <div class="error" *ngIf="f.donationAmount.invalid && (f.donationAmount.dirty || f.donationAmount.touched)">
                <div *ngIf="f.donationAmount.errors.min">Sorry, the minimum donation is currently £5.</div>
                <div *ngIf="f.donationAmount.errors.max">Sorry, the maximum single donation is £25,000.</div>
                <div *ngIf="f.donationAmount.errors.pattern">Please enter a whole number of pounds (£) without commas or pence.</div>
                <div *ngIf="f.donationAmount.errors.required">Please enter how much you would like to donate.</div>
              </div>
            </mat-expansion-panel>

            <mat-expansion-panel expanded="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3 id="giftAid-label" class="b-rh-2">Gift Aid</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <p class="no-margin-top b-rt-1"><strong>Boost your donation by 25p of Gift Aid for every £1 you donate.</strong></p>
              <p class="b-rt-0">'I confirm that I am a UK tax payer and I understand that if I pay less income tax and/or capital gains tax in the current tax year than the amount of Gift Aid claimed on all my donations it is my responsibility to pay the difference'.</p>
              <p class="b-rt-0">Gift Aid is a government scheme for UK charities to reclaim the tax you have paid and gain 25% more at no cost or hassle to you.
                <a href="https://www.thebiggive.org.uk/s/terms-and-conditions" target="_blank"><mat-icon aria-hidden="false" aria-label="Open in new tab">open_in_new</mat-icon> Find out more about Gift Aid</a>.
              </p>
              <mat-radio-group aria-labelledby="giftAid-label" formControlName="giftAid">
                <mat-radio-button labelPosition="after" [value]="true">Yes, I am a UK tax payer and would like Gift Aid claimed on my donations</mat-radio-button>
                <mat-radio-button labelPosition="after" [value]="false">No, I am not a UK tax payer and do not want Gift Aid claimed on my donations</mat-radio-button>
              </mat-radio-group>
            </mat-expansion-panel>

            <mat-expansion-panel expanded="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3 class="b-rh-2" id="optInCharityEmail-label">Contact from charity</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <p class="no-margin-top b-rt-1"><strong>Would you be happy to receive emails from {{ campaign.charity.name }}?</strong></p>
              <p class="b-rt-0">This may include thanks for your donation, updates on how it is being used, newsletters and future campaigns. If you select no, we will pass on your details as these may be required for Gift Aid purposes, but the charity will be informed that you do not wish to receive communications.</p>
              <p class="b-rt-0">Please note that you might continue to receive communications from {{ campaign.charity.name }} if you have already shared your details with them via other methods.</p>
              <mat-radio-group aria-labelledby="optInCharityEmail-label" formControlName="optInCharityEmail">
                <mat-radio-button labelPosition="after" [value]="true">Yes, I’m happy to receive emails from {{ campaign.charity.name }}</mat-radio-button>
                <mat-radio-button labelPosition="after" [value]="false">No, I would not like to receive emails from {{ campaign.charity.name }}</mat-radio-button>
              </mat-radio-group>
            </mat-expansion-panel>

            <mat-expansion-panel expanded="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3 class="b-rh-2" id="optInTbgEmail-label">Contact from The Big Give</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <p class="no-margin-top b-rt-1"><strong>Would you be happy to receive emails from The Big Give?</strong></p>
              <p class="b-rt-0">By selecting 'no', we will no longer be able to email you about opportunities to double your donation.</p>
              <mat-radio-group aria-labelledby="optInTbgEmail-label" formControlName="optInTbgEmail">
                <mat-radio-button labelPosition="after" [value]="true">Yes, I’m happy to receive emails from The Big Give</mat-radio-button>
                <mat-radio-button labelPosition="after" [value]="false">No, I would not like to receive emails from The Big Give</mat-radio-button>
              </mat-radio-group>
            </mat-expansion-panel>

            <mat-expansion-panel class="c-make-your-donation" expanded="true" disabled="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3 class="b-rh-2">Make your donation</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <p class="b-rt-0">By clicking on the <em>Donate</em> button, you agree to the Big Give's
                <a href="https://www.thebiggive.org.uk/s/terms-and-conditions" target="_blank"><mat-icon aria-hidden="false" aria-label="Open in new tab">open_in_new</mat-icon> Terms and Conditions</a> and
                <a href="https://www.thebiggive.org.uk/s/privacy-policy" target="_blank"><mat-icon aria-hidden="false" aria-label="Open in new tab">open_in_new</mat-icon> Privacy Policy</a>.
              </p>

              <div class="c-donation-summary">
                <p class="error" *ngIf="sfApiError">
                  Sorry, we can't submit your donation right now. Please try again in a moment
                  or <a href="https://www.thebiggive.org.uk/s/contact-us" target="_blank"><mat-icon aria-hidden="false" aria-label="Open in new tab">open_in_new</mat-icon> contact us</a>
                  if this message persists.
                </p>

                <p class="error" *ngIf="validationError">
                  Please complete all fields above to proceed with your donation.
                </p>

                <mat-spinner *ngIf="submitting" color="accent" diameter="30"></mat-spinner>

                <p *ngIf="retrying" class="warning">
                  It looks like our system is a bit busy, one moment please&hellip;
                </p>

                <button
                  mat-raised-button
                  type="submit"
                  [disabled]="submitting"
                >
                  Donate 
                  <strong>
                    {{ donationForm.value.donationAmount | currency : '£' : 'symbol' : '1.0-0' }}
                  </strong>
                </button>
                <div class="donation-receipt" fxLayout="row" *ngIf="donationForm.value.donationAmount > 0">
                  <div [fxFlex]="(expectedMatchAmount() > 0) ? 26 : 39">
                    <p class="b-center b-grey b-rt-sm">Your donation</p>
                    <p class="b-center b-grey b-rt-0"><strong>{{ donationForm.value.donationAmount | currency : '£' : 'symbol' : '1.0-0' }}</strong></p>
                  </div>
                  <div fxFlex="11" fxLayout="row" fxLayoutAlign="center end">
                    <mat-icon class="plus" aria-hidden="false" aria-label="Plus">add</mat-icon>
                  </div>
                  <div fxFlex="26" *ngIf="expectedMatchAmount() > 0">
                    <p class="b-center b-grey b-rt-sm"><small>Matched funds</small></p>
                    <p class="b-center b-grey b-rt-0"><strong>{{ expectedMatchAmount() | currency : '£' : 'symbol' : '1.0-0' }}</strong></p>
                  </div>
                  <div fxFlex="11" fxLayout="row" fxLayoutAlign="center end" *ngIf="expectedMatchAmount() > 0">
                    <mat-icon class="plus" aria-hidden="false" aria-label="Plus">add</mat-icon>
                  </div>
                  <div [fxFlex]="(expectedMatchAmount() > 0) ? 26 : 39">
                    <p class="b-center b-grey b-rt-sm"><small>Gift Aid</small></p>
                    <p class="b-center b-grey b-rt-0"><strong>{{ giftAidAmount() | currency : '£' : 'symbol' : '1.2-2' }}</strong></p>
                  </div>
                </div>
                <div class="receipt-total" fxLayout="row" fxLayoutAlign="space-around" *ngIf="donationForm.value.donationAmount > 0">
                  <p class="b-rt-0">Total for {{ campaign.charity.name }}:</p>
                  <p class="b-rt-1"><strong>{{ expectedTotalAmount() | currency : '£' : 'symbol' : '1.2-2' }}</strong></p>
                </div>
              </div>

            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </form>
    </div>

    <div class="b-secondary-column">
      <app-campaign-details-card [campaign]="campaign"></app-campaign-details-card>
    </div>
  </div>
</div>
