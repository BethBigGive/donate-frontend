<app-hero
  *ngIf="campaign && fund"
  [title]="fund.name + ' &ndash; ' + campaign.title"
  [description]="fund.description"
></app-hero>
<app-hero
  *ngIf="campaign && !fund"
  [title]="campaign.title"
  [description]="campaign.summary"
></app-hero>

<mat-card *ngIf="campaign">
  <mat-card-header *ngIf="fund">
    <img *ngIf="fund.logoUri" [src]="fund.logoUri + '?width=200'" width="100" [alt]="fund.name + ' logo'">
    <mat-card-subtitle *ngIf="campaign.status == 'Preview'">Opens in {{ campaign.startDate | timeLeft }}</mat-card-subtitle>
    <mat-card-subtitle *ngIf="campaign.status != 'Preview'">{{ fund.amountRaised | currency : '£' : 'symbol' : '1.0-0' }} raised</mat-card-subtitle>
  </mat-card-header>

  <mat-card-header *ngIf="!fund">
    <mat-card-subtitle *ngIf="campaign.status == 'Preview'">Opens in {{ campaign.startDate | timeLeft }}</mat-card-subtitle>
    <mat-card-subtitle *ngIf="campaign.status != 'Preview'">{{ campaign.amountRaised | currency : '£' : 'symbol' : '1.0-0' }} raised</mat-card-subtitle>
  </mat-card-header>
</mat-card>

<div *ngIf="campaign && children">
  <h2>Participating Campaigns</h2>
  <h3>Search in {{ campaign.title }}</h3>
  <app-campaign-search-form [campaignId]="campaign.id" (search)="onMetacampaignSearch($event)"></app-campaign-search-form>

  <h3>Filters</h3>
  <mat-form-field>
    <mat-label>Beneficiary</mat-label>
    <mat-select value="" (selectionChange)="setQueryProperty('beneficiary', $event)">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let beneficiary of beneficiaryOptions" [value]="beneficiary">{{ beneficiary }}</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field>
    <mat-label>Category</mat-label>
    <mat-select value="" (selectionChange)="setQueryProperty('category', $event)">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let category of categoryOptions" [value]="category">{{ category }}</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field>
    <mat-label>Country</mat-label>
    <mat-select value="" (selectionChange)="setQueryProperty('country', $event)">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let country of countryOptions" [value]="country">{{ country }}</mat-option>
    </mat-select>
  </mat-form-field>

  <h3>Sort By</h3>
  <mat-form-field>
    <mat-label>Field</mat-label>
    <mat-select value="" (selectionChange)="setSortField($event)">
      <mat-option value="">Relevance</mat-option>
      <mat-option value="amountRaised">Amount raised</mat-option>
      <mat-option value="matchFundsRemaining">Match funds remaining</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field>
    <mat-label>Direction</mat-label>
    <mat-select [(value)]="sortDirection" [disabled]="!sortDirectionEnabled" (selectionChange)="setQueryProperty('sortDirection', $event)">
      <mat-option selected value="asc">Ascending</mat-option>
      <mat-option value="desc">Descending</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-grid-list [cols]="cols()" rowHeight="27rem" gutterSize="1rem">
    <mat-grid-tile *ngFor="let campaign of children">
      <app-campaign-card [campaign]="campaign"></app-campaign-card>
    </mat-grid-tile>
  </mat-grid-list>
</div>

<div *ngIf="filterError">
  <!-- e.g. campaign or fund slug is not recognised -->
  <p class="error">Could not load the campaign. You might have followed a broken link.</p>
  <p>Not to worry, you can <a routerLink="/">browse all active campaigns here</a>!</p>
</div>
